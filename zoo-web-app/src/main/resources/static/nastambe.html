<html>

<head>
    <title>ZOO WEB APP</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <h1>ZOO WEB APP - PODACI O NASTAMBAMA</h1>
    </header>
    <div id="header-container">
    </div>
    <div id="section-2">
        <nav>
            <ul>
                <li>POCETNA</li>
                <a href="zoo.html" target="_self">
                    <li>ZOO</li>
                </a>
                <a href="Zivotinja.html" target="_self">
                    <li>Zivotinje</li>
                </a>
                <a href="" target="_self">
                    <li>Nastambe</li>
                </a>
                <a href="" target="_self">
                    <li>Radnici</li>
                </a>
                <a href="" target="_self">
                    <li>Obaveze</li>
                </a>
                <a href="" target="_self">
                    <li>Posjete</li>
                </a>
                <a href="" target="_self">
                    <li>Incidenti</li>
                </a>
            </ul>
        </nav>
        <main>
            <div class="input-cont" id="dodaj-karakteristiku-cont">
                <h3>Dodaj karakteristiku:</h3>
                <input id="input-karakteristike" class="manji-input" type="text">
                <button id="dodaj-karakteristiku-btn" onClick="dodajKarakteristiku()"
                    class="veci-button">Dodaj</button><br>
                <div id="lista-karakteristika">
                    <span class="karakteristika">Suncano <button class="x-button">x</button></span>
                </div>

            </div>
            <div class="input-cont" id="dodaj-nastambu-cont">
                <h3>Dodaj nastambu:</h3>
                <h4>Oznaka:</h4> <input type="text" id="input-oznake" class="manji-input"><br>
                <h4>Geometrija:</h4> <input type="text" id="input-geometrije" class="manji-input"><br>
                <h4>Karakteristike:</h4>
                <div id="ponuda-karakteristika">

                </div>
                <br><h4>Zivotinje:</h4>
                <div id="ponuda-zivotinja">

                </div>
                <br><br>
                <button id="dodaj-nastambu-btn" onClick="dodajNastambu()" class="veci-button">Dodaj</button><br>

            </div>
            <div class="input-cont" id="trenutne-nastambe">
                <h3>Trenutne nastambe:</h3>
            </div>
        </main>
    </div>
    <script>
        const API_URL_K = "http://localhost:8080/karakteristike";
        const API_URL_N = "http://localhost:8080/nastamba";

        async function prikaziKarakteristike() {
            const rez = await fetch(API_URL_K);
            const rezJSON = await rez.json();

            const lista = document.getElementById("lista-karakteristika");
            const div = document.getElementById("ponuda-karakteristika");
            lista.innerHTML = "";
            div.innerHTML = "";

            rezJSON.forEach(k => {
                const span = document.createElement("span");
                span.className = "karakteristika";
                span.textContent = `${k.naziv_karakteristike}`;


                const label = document.createElement("label");
                const karak = document.createElement("input");
                label.textContent = `   ${k.naziv_karakteristike}`;
                karak.type = "checkbox";
                karak.value = `${k.id_karakteristike}`;
                label.append(karak)

                const button = document.createElement("button")
                button.className = "x-button";
                button.innerHTML = "x";
                button.onclick = async () => {
                    await fetch(`${API_URL_K}/${k.id_karakteristike}`, { method: "DELETE" });
                    await prikaziKarakteristike();
                }

                div.append(label);
                span.append(button);
                lista.append(span);
            });

        }

        async function dodajKarakteristiku() {
            const nazivInput = document.getElementById("input-karakteristike");
            const naziv = nazivInput.value;

            if (naziv) {
                await fetch(API_URL_K, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ naziv_karakteristike: naziv })
                });
                document.getElementById("input-karakteristike").value = "";
                await prikaziKarakteristike();
            }
        }
        async function prikaziZivotinje(){
            const API_URL = "http://localhost:8080/api/zivotinje";

            const data = await fetch(API_URL);
            const res = await data.json();
            const ponudaDiv = document.getElementById("ponuda-zivotinja");

            ponudaDiv.innerHTML = "";

            res.forEach(z =>{
               const label = document.createElement("label");
               label.textContent=`${z.ime}`;
                const check = document.createElement("input");
               check.type="checkbox";
               check.value = `${z.id}`;

                ponudaDiv.append(check);
                ponudaDiv.append(label);
            });
        }

        async function prikaziNastambe() {
            const res = await fetch(API_URL_N)
            const data = await res.json();

            console.log(res);
            console.log(data);

            const lista = document.getElementById("trenutne-nastambe")
            lista.innerHTML = "";

            data.forEach(n => {
                const divNastamba = document.createElement("div");
                divNastamba.className = "nastamba-cont";
                divNastamba.innerHTML += `Oznaka: ${n.oznaka}<br>Geometrija: ${n.geometrija}<br>`;
                divNastamba.innerHTML += "Karakteristike: ";
                n.karakteristike.forEach(k => {
                    divNastamba.innerHTML += `${k.naziv_karakteristike}, `;
                });
                divNastamba.innerHTML += "<br>Zivotinje: ";
                n.zivotinje.forEach(z =>{
                    divNastamba.innerHTML += `${z.ime}`;
                });
                const button = document.createElement("button");
                button.innerHTML = "Obrisi";
                button.id = "nastamba-delete-btn";
                button.onclick = async () => {
                    await fetch(`${API_URL_N}/${n.id_nastambe}`, { method: "DELETE" });
                    await prikaziNastambe();
                }

                divNastamba.append(button);
                lista.append(divNastamba);
            });
        }

        async function dodajNastambu() {
            const oznakaInput = document.getElementById("input-oznake");
            const geometrijaInput = document.getElementById("input-geometrije");
            const oznaka = oznakaInput.value;
            const geometrija = geometrijaInput.value;

            const checkedKarakt = [...document.querySelectorAll('#ponuda-karakteristika input:checked')].map(c => parseInt(c.value));
            const checkedZivotinje = [...document.querySelectorAll('#ponuda-zivotinja input:checked')].map(z=>parseInt(z.value));

            console.log(checkedZivotinje);

            if ((geometrija) && (oznaka)) {
                await fetch(API_URL_N, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        oznaka: oznaka,
                        geometrija: geometrija,
                        karakteristikeIds: checkedKarakt,
                        zivotinjeIds: checkedZivotinje
                    })
                });
                await prikaziNastambe();
                oznakaInput.value = "";
                geometrijaInput.value = "";

                document.querySelectorAll('#ponuda-zivotinja input[type="checkbox"]').forEach(cb => cb.checked = false);
                document.querySelectorAll('#ponuda-karakteristika input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
        }

        prikaziNastambe();
        prikaziZivotinje();
        prikaziKarakteristike();
    </script>
</body>

</html>