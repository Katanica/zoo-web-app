<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>ZOO WEB APP - Obaveze</title>

    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --danger: #e74c3c;
            --success: #27ae60;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }

        body {
            font-family: Segoe UI, sans-serif;
            background: linear-gradient(135deg,#f5f7fa,#c3cfe2);
            color: var(--dark);
            padding: 2rem;
        }

        header { text-align:center; margin-bottom:2rem; }
        h1 { color:var(--primary); }

        .back-btn {
            background: var(--secondary);
            color:white;
            padding:0.7rem 1.5rem;
            text-decoration:none;
            border-radius:8px;
            font-weight:600;
        }

        .container {
            max-width:1000px;
            margin:auto;
            display:grid;
            grid-template-columns:1fr;
            gap:1.5rem;
        }

        .card {
            background:white;
            padding:1.5rem;
            border-radius:12px;
            box-shadow:0 4px 12px rgba(0,0,0,0.1);
        }

        .manji-input, select {
            width:100%;
            padding:0.7rem;
            margin:0.5rem 0;
            border:1px solid #ccc;
            border-radius:6px;
        }

        .veci-button {
            background:var(--success);
            color:white;
            border:none;
            padding:0.7rem 1.2rem;
            border-radius:6px;
            cursor:pointer;
            margin-top:0.5rem;
        }

        .obaveza-card {
            background:var(--light);
            padding:1rem;
            border-radius:10px;
            border-left:4px solid var(--secondary);
            margin-bottom:1rem;
            position:relative;
        }

        .delete-btn {
            position:absolute;
            top:1rem;
            right:1rem;
            background:var(--danger);
            color:white;
            padding:0.4rem 0.7rem;
            border:none;
            border-radius:6px;
            cursor:pointer;
        }
    </style>
</head>

<body>

<header>
    <a href="index.html" class="back-btn">POČETNA</a>
    <h1>OBAVEZE</h1>
</header>

<div class="container">

    <!-- NOVA OBAVEZA -->
    <div class="card">
        <h3>Dodaj novu obavezu</h3>

        <h4>Vrsta obaveze</h4>
        <select id="tip">
            <option value="HRANJENJE">Hranjenje</option>
            <option value="CISCENJE">Čišćenje</option>
            <option value="PREGLED">Veterinarski pregled</option>
        </select>

        <h4>Životinja</h4>
        <select id="zivotinja"></select>

        <h4>Opis</h4>
        <input type="text" id="opis" class="manji-input" placeholder="npr. Hranjenje mesa, detalji...">

        <h4>Tip obaveze</h4>
        <select id="ponavljanje" onchange="togglePonavljanje()">
            <option value="NONE">Jednokratna</option>
            <option value="DAILY">Svaki dan</option>
        </select>

        <div id="jednokratna-polja">
            <h4>Datum i vrijeme</h4>
            <input type="datetime-local" id="datetime" class="manji-input">
        </div>

        <div id="ponavljajuca-polja" style="display:none;">
            <h4>Vrijeme svaki dan</h4>
            <input type="time" id="ponavljajuce-vrijeme" class="manji-input">
        </div>

        <h4>Dodijeli radnika (opcionalno)</h4>
        <select id="radnik">
            <option value="">(bez radnika)</option>
        </select>

        <button class="veci-button" onclick="dodajObavezu()">Dodaj obavezu</button>
    </div>

    <!-- LISTA OBAVEZA -->
    <div class="card">
        <h3>Planirane obaveze</h3>
        <div id="obaveze"></div>
    </div>

</div>

<script>
    const API_O = "http://localhost:8080/obaveze";
    const API_Z = "http://localhost:8080/api/zivotinje";
    const API_R = "http://localhost:8080/radnici";

    function togglePonavljanje() {
        const tip = document.getElementById("ponavljanje").value;
        document.getElementById("jednokratna-polja").style.display = tip === "NONE" ? "block" : "none";
        document.getElementById("ponavljajuca-polja").style.display = tip === "DAILY" ? "block" : "none";
    }

    async function prikaziZivotinje() {
        const res = await fetch(API_Z);
        const data = await res.json();
        const sel = document.getElementById("zivotinja");
        sel.innerHTML = "";

        data.forEach(z => {
            const op = document.createElement("option");
            op.value = z.id;
            op.textContent = z.ime + " (" + z.latinskiNaziv + ")";
            sel.appendChild(op);
        });
    }

    async function prikaziRadnike() {
        const res = await fetch(API_R);
        const data = await res.json();
        const sel = document.getElementById("radnik");

        data.forEach(r => {
            const op = document.createElement("option");
            op.value = r.id;
            op.textContent = r.ime + " " + r.prezime;
            sel.appendChild(op);
        });
    }

    async function prikaziObaveze() {
        const res = await fetch(API_O);
        const data = await res.json();
        const cont = document.getElementById("obaveze");
        cont.innerHTML = "";

        data.forEach(o => {
            const d = document.createElement("div");
            d.className = "obaveza-card";

            let html = `<strong>Tip:</strong> ${o.tip}<br>`;
            html += `<strong>Životinja:</strong> ${o.zivotinja.ime}<br>`;
            html += `<strong>Opis:</strong> ${o.opis}<br>`;

            if (o.ponavljanje === "NONE")
                html += `<strong>Datum:</strong> ${o.datum}<br>`;
            else
                html += `<strong>Ponavljanje:</strong> svaki dan u ${o.vrijeme}<br>`;

            html += `<strong>Radnik:</strong> ${o.radnik ? o.radnik.ime : "nije dodijeljen"}`;

            d.innerHTML = html;

            const btn = document.createElement("button");
            btn.className = "delete-btn";
            btn.textContent = "Obriši";
            btn.onclick = async () => {
                await fetch(`${API_O}/${o.id}`, { method: "DELETE" });
                prikaziObaveze();
            };

            d.appendChild(btn);
            cont.appendChild(d);
        });
    }

    async function dodajObavezu() {
        const payload = {
            tip: document.getElementById("tip").value,
            opis: document.getElementById("opis").value,
            idZivotinje: parseInt(document.getElementById("zivotinja").value),
            ponavljanje: document.getElementById("ponavljanje").value,
            idRadnika: document.getElementById("radnik").value || null
        };

        if (payload.ponavljanje === "NONE") {
            payload.datum = document.getElementById("datetime").value;
        } else {
            payload.vrijeme = document.getElementById("ponavljajuce-vrijeme").value;
        }

        await fetch(API_O, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
        });

        prikaziObaveze();
        alert("Obaveza dodana!");
    }

    document.addEventListener("DOMContentLoaded", () => {
        prikaziZivotinje();
        prikaziRadnike();
        prikaziObaveze();
    });
</script>

</body>
</html>
